package com.example.CapAcademy.Controller;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.CapAcademy.Repositories.DemandeRepository;
import com.example.CapAcademy.Repositories.FormationRepository;
import com.example.CapAcademy.models.Demande;
import com.example.CapAcademy.models.Formation;



@RestController
@CrossOrigin(origins ="*")
public class DemandeController {

	@Autowired
	DemandeRepository DR ; 
	
	@Autowired
	private	FormationRepository FR ;
	
	@RequestMapping(value="/AddDemande/{idFormation}/{FormationName}" , method=RequestMethod.POST)
	public Long Save(@RequestBody Demande c , @PathVariable  long idFormation , @PathVariable  String FormationName  ) {
		
		
		
		c.setIdFormation(idFormation);
		c.setFormation(FormationName);
		
		DR.save(c) ; 
		
		
		
		
		 	return c.getId() ; 
	}
	
	
	@GetMapping(value = "/Demande/{email}", produces = MediaType.APPLICATION_JSON_VALUE)
	public List<Demande> getDemandes(@PathVariable String email) {
		
		return DR.findByEmail(email);
	}
	
	@GetMapping(value = "/Demande", produces = MediaType.APPLICATION_JSON_VALUE)
	public List<Demande> getAllDemandes() {
		
		return DR.findAll();
	}
	
	

	 
	@RequestMapping(value="/Demande/{id}" , method=RequestMethod.PUT)
	public Demande Save(@RequestBody Demande c , @PathVariable   long id ) {
		c.setId(id); 
		c.setEtat("valided");
		return DR.save(c) ;
	}
	
	
	
	@GetMapping(value = "/FD/{email}", produces = MediaType.APPLICATION_JSON_VALUE)
	public List<Formation> getAllFormationDemande(@PathVariable String email) {
		
		List<Formation> listResult = new ArrayList<Formation>() ;
		List<Demande> list2 = DR.findByEmail(email)  ;
		List<Formation> list3  = FR.findAll() ; 
		// list2.get(i).getEmail()== ""
		
		
		for (int i = 0; i < list2.size() ; i++) {
			
			if (  list2.get(i).getEtat()=="valided")
			{
				
				for (int j = 0; j < list3.size(); j++) {
					
					if (list2.get(i).getIdFormation() == list3.get(j).getId()) {
						
						listResult.add(list3.get(j)) ; 
						System.out.println("sssssssssssssss");
						
					}
					
					
					
				}
				
			}
		}
		
		return listResult ; 
		
		
	}
	
	
	
	
	
	
	
	
	
	
}
